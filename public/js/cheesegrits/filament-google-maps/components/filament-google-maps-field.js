function H({state:b,setStateUsing:r,getStateUsing:_,autocomplete:l,autocompleteReverse:f,geolocate:M=!1,geolocateOnLoad:v,geolocateLabel:G,draggable:L,clickable:E,defaultLocation:w,statePath:Q,controls:O,layers:A,reverseGeocodeFields:c,defaultZoom:P,types:T,countries:R,placeField:u,debug:D,gmaps:N,mapEl:S,pacEl:F,drawingControl:I,drawingControlPosition:B,polyOptions:j={fillColor:"#f06eaa",strokeColor:"#00ff00",strokeOpacity:"0.5",strokeWeight:3,fillOpacity:.45,draggable:!0,editable:!1,clickable:!0},circleOptions:x={fillColor:"#f06eaa",strokeColor:"#00ff00",strokeOpacity:"0.5",strokeWeight:3,fillOpacity:.45,draggable:!0,editable:!1,clickable:!0},rectangleOptions:V={fillColor:"#f06eaa",strokeColor:"#00ff00",strokeOpacity:"0.5",strokeWeight:3,fillOpacity:.45,draggable:!0,editable:!1,clickable:!0},drawingModes:g={marker:!0,circle:!0,rectangle:!0,polygon:!0,polyline:!0},drawingField:m,geoJson:p,geoJsonField:y,geoJsonProperty:d,geoJsonVisible:Y,reverseGeocodeUsing:K,placeUpdatedUsing:k,hasReverseGeocodeUsing:C=!1,hasPlaceUpdatedUsing:h=!1,mapType:J="roadmap"}){return{state:b,map:null,geocoder:null,marker:null,markerLocation:null,layers:null,symbols:{"%n":["street_number"],"%z":["postal_code"],"%S":["street_address","route"],"%A1":["administrative_area_level_1"],"%A2":["administrative_area_level_2"],"%A3":["administrative_area_level_3"],"%A4":["administrative_area_level_4"],"%A5":["administrative_area_level_5"],"%a1":["administrative_area_level_1"],"%a2":["administrative_area_level_2"],"%a3":["administrative_area_level_3"],"%a4":["administrative_area_level_4"],"%a5":["administrative_area_level_5"],"%L":["locality","postal_town"],"%D":["sublocality"],"%C":["country"],"%c":["country"],"%p":["premise"],"%P":["premise"],"%sp":["subpremise","route"],"%SP":["subpremise","route"]},drawingManager:null,overlays:[],dataLayer:null,geoJsonDataLayer:null,polyOptions:j,circleOptions:x,rectangleOptions:V,selectedShape:null,placesService:null,placeFields:[],loadGMaps:function(){if(document.getElementById("filament-google-maps-google-maps-js")){let e=function(t,o){window[t]?o():setTimeout(function(){e(t,o)},100)};e("filamentGoogleMapsAPILoaded",function(){this.createMap()}.bind(this))}else{let e=document.createElement("script");e.id="filament-google-maps-google-maps-js",window.filamentGoogleMapsAsyncLoad=this.createMap.bind(this),e.src=N+"&callback=filamentGoogleMapsAsyncLoad",document.head.appendChild(e)}},init:function(){this.loadGMaps()},createMap:function(){if(window.filamentGoogleMapsAPILoaded=!0,(f||Object.keys(c).length>0)&&(this.geocoder=new google.maps.Geocoder),this.map=new google.maps.Map(S,{center:this.getCoordinates(),zoom:P,mapTypeId:google.maps.MapTypeId[J.toUpperCase()],...O}),this.marker=new google.maps.Marker({draggable:L,map:this.map}),this.marker.setPosition(this.getCoordinates()),E&&this.map.addListener("click",e=>{this.markerMoved(e)}),L&&google.maps.event.addListener(this.marker,"dragend",e=>{this.markerMoved(e)}),O.searchBoxControl){let e=F,t=new google.maps.places.SearchBox(e);this.map.controls[google.maps.ControlPosition.TOP_LEFT].push(e),t.addListener("places_changed",()=>{e.value="",this.markerLocation=t.getPlaces()[0].geometry.location})}if(h&&(this.placesService=new google.maps.places.PlacesService(this.map)),this.placeFields=["address_components","formatted_address","geometry","name"],this.placeFields.includes(u)||this.placeFields.push(u),h&&this.placeFields.push("photos"),l){let e=document.getElementById(l);if(e){window.addEventListener("keydown",function(a){if((a.key==="U+000A"||a.key==="Enter"||a.code==="Enter")&&a.target.nodeName==="INPUT"&&a.target.type==="text")return a.preventDefault(),!1},!0);let t={fields:this.placeFields,strictBounds:!1,types:T},o=new google.maps.places.Autocomplete(e,t);o.setComponentRestrictions({country:R}),o.addListener("place_changed",()=>{let a=o.getPlace();if(!a.geometry||!a.geometry.location){window.alert("No details available for input: '"+a.name+"'");return}a.geometry.viewport?this.map.fitBounds(a.geometry.viewport):this.map.setCenter(a.geometry.location),r(l,a[u]),this.marker.setPosition(a.geometry.location),this.markerLocation=a.geometry.location,this.setCoordinates(a.geometry.location),this.updateGeocodeFromAddressComponents(a.address_components),h&&k(a)})}}if(A&&(this.layers=A.map(e=>{new google.maps.KmlLayer({url:e,map:this.map}).addListener("click",o=>{let a=o.featureData.description})})),p&&(Y?this.geoJsonDataLayer=this.map.data:this.geoJsonDataLayer=new google.maps.Data,/^http/.test(p)?this.geoJsonDataLayer.loadGeoJson(p):this.geoJsonDataLayer.addGeoJson(JSON.parse(p))),v&&this.getLocation(),M&&"geolocation"in navigator){let e=document.createElement("button");e.textContent=G,e.classList.add("custom-map-control-button"),this.map.controls[google.maps.ControlPosition.TOP_CENTER].push(e),e.addEventListener("click",t=>{t.preventDefault(),this.getLocation()})}if(I&&(this.map.data.setStyle({clickable:!1,cursor:null,draggable:!1,editable:!1,fillOpacity:0,visible:!1}),this.drawingManager=new google.maps.drawing.DrawingManager({drawingMode:null,drawingControl:!0,drawingControlOptions:{position:B,drawingModes:[...g.marker?[google.maps.drawing.OverlayType.MARKER]:[],...g.circle?[google.maps.drawing.OverlayType.CIRCLE]:[],...g.polygon?[google.maps.drawing.OverlayType.POLYGON]:[],...g.polyline?[google.maps.drawing.OverlayType.POLYLINE]:[],...g.rectangle?[google.maps.drawing.OverlayType.RECTANGLE]:[]]},markerOptions:{draggable:!0},polylineOptions:{draggable:!0,editable:!1},rectangleOptions:this.rectangleOptions,circleOptions:this.circleOptions,polygonOptions:this.polyOptions}),this.drawingManager.setMap(this.map),google.maps.event.addListener(this.drawingManager,"drawingmode_changed",()=>{this.clearSelection()}),m)){this.dataLayer=new google.maps.Data;let e=_(m);e&&this.loadFeaturesCollection(JSON.parse(e)),google.maps.event.addListener(this.drawingManager,"overlaycomplete",t=>{t.overlay.type=t.type,t.overlay.id=this.guid(),t.overlay.feature=this.instanceFeature(t.overlay),this.addOverlayEvents(t.overlay),this.overlays.push(t.overlay),t.type!=google.maps.drawing.OverlayType.MARKER&&(this.drawingManager.setDrawingMode(null),this.setSelection(t.overlay)),this.drawingModified()})}this.$watch("state",()=>{if(this.state===void 0)return;let e=this.getCoordinates(),t=this.marker.getPosition();e.lat===t.lat()&&e.lng===t.lng()||(this.updateAutocompleteFromLocation(e),this.updateMap(e))})},markerMoved:function(e){this.geoJsonContains(e.latLng),this.markerLocation=e.latLng.toJSON(),this.setCoordinates(this.markerLocation),this.updateFromLocation(this.markerLocation),this.map.panTo(this.markerLocation),h&&e.placeId&&this.placesService.getDetails({placeId:e.placeId,fields:this.placeFields},(t,o)=>{o==="OK"&&k(t)})},updateMap:function(e){this.marker.setPosition(e),this.map.panTo(e)},updateFromLocation:function(e){(this.hasReverseGeocode()||this.hasReverseAutocomplete())&&this.geocoder.geocode({location:e}).then(t=>{this.updateGeocodeFromAddressComponents(t.results[0].address_components),this.updateAutocompleteFromFormattedAddress(t.results[0].formatted_address),C&&K(t)}).catch(t=>{console.log(t.message)})},updateGeocodeFromAddressComponents:function(e){if(this.hasReverseGeocode()){let t=this.getReplacements(e);for(let o in c){let a=c[o];for(let s in t)a=a.split(s).join(t[s]);for(let s in this.symbols)a=a.split(s).join("");a=a.trim(),r(o,a)}}},updateGeocodeFromLocation:function(e){this.hasReverseGeocode()&&this.geocoder.geocode({location:e}).then(t=>t.results[0].address_components).then(t=>this.updateGeocodeFromAddressComponents(t)).catch(t=>{console.log(t.message)})},updateAutocompleteFromFormattedAddress:function(e){this.hasReverseAutocomplete()&&r(l,e)},updateAutocompleteFromLocation:function(e){this.hasReverseAutocomplete()&&this.geocoder.geocode({location:e}).then(t=>{t.results[0]&&r(l,t.results[0].formatted_address)}).catch(t=>{console.log(t.message)})},hasReverseAutocomplete:function(){return l&&f},hasReverseGeocode:function(){return Object.keys(c).length>0||C},setCoordinates:function(e){this.state=e},getCoordinates:function(){return(this.state===null||!this.state.hasOwnProperty("lat"))&&(this.state={lat:w.lat,lng:w.lng}),this.state},getLocation:function(){navigator.geolocation.getCurrentPosition(e=>{this.markerLocation={lat:e.coords.latitude,lng:e.coords.longitude},this.setCoordinates(this.markerLocation),this.updateFromLocation(this.markerLocation),this.map.panTo(this.markerLocation)})},getReplacements:function(e){let t={};return e.forEach(o=>{for(let a in this.symbols)this.symbols[a].indexOf(o.types[0])!==-1&&(a===a.toLowerCase()?t[a]=o.short_name:t[a]=o.long_name)}),D&&console.log(t),t},instanceOverlay:function(e){var t=null;switch(e.properties.type){case google.maps.drawing.OverlayType.MARKER:t=new google.maps.Marker({id:e.properties.id,type:e.properties.type,position:new google.maps.LatLng(e.geometry.coordinates[1],e.geometry.coordinates[0]),draggable:!0});break;case google.maps.drawing.OverlayType.RECTANGLE:var o=new google.maps.LatLng(e.geometry.coordinates[0][2][1],e.geometry.coordinates[0][2][0]),a=new google.maps.LatLng(e.geometry.coordinates[0][0][1],e.geometry.coordinates[0][0][0]);t=new google.maps.Rectangle(Object.assign({},this.polyOptions,{id:e.properties.id,type:e.properties.type,bounds:new google.maps.LatLngBounds(a,o),editable:!1}));break;case google.maps.drawing.OverlayType.POLYGON:t=new google.maps.Polygon(Object.assign({},this.polyOptions,{id:e.properties.id,type:e.properties.type,paths:this.transformToMVCArray(e.geometry.coordinates),editable:!1}));break;case google.maps.drawing.OverlayType.POLYLINE:t=new google.maps.Polyline({id:e.properties.id,type:e.properties.type,path:this.transformToMVCArray([e.geometry.coordinates]).getAt(0),draggable:!0,editable:!1});break;case google.maps.drawing.OverlayType.CIRCLE:t=new google.maps.Circle(Object.assign({},this.polyOptions,{id:e.properties.id,type:e.properties.type,center:new google.maps.LatLng(e.geometry.coordinates[1],e.geometry.coordinates[0]),radius:e.properties.radius,editable:!1}));break}return t},instanceFeature:function(e){var t=this.calculateGeometry(e);return this.dataLayer.add(new google.maps.Data.Feature({geometry:t.geometry,properties:Object.assign({id:this.guid(),type:e.type},t.hasOwnProperty("properties")?t.properties:{})}))},calculateGeometry:function(e,t){switch(e.type){case google.maps.drawing.OverlayType.MARKER:return t?new google.maps.Data.Point(e.getPosition()):{geometry:new google.maps.Data.Point(e.getPosition())};case google.maps.drawing.OverlayType.RECTANGLE:let o=e.getBounds(),a=[o.getSouthWest(),{lat:o.getSouthWest().lat(),lng:o.getNorthEast().lng()},o.getNorthEast(),{lng:o.getSouthWest().lng(),lat:o.getNorthEast().lat()}];return t?new google.maps.Data.Polygon([a]):{geometry:new google.maps.Data.Polygon([a])};case google.maps.drawing.OverlayType.POLYGON:return t?new google.maps.Data.Polygon([e.getPath().getArray()]):{geometry:new google.maps.Data.Polygon([e.getPath().getArray()])};case google.maps.drawing.OverlayType.POLYLINE:return t?new google.maps.Data.LineString(e.getPath().getArray()):{geometry:new google.maps.Data.LineString(e.getPath().getArray())};case google.maps.drawing.OverlayType.CIRCLE:return t?new google.maps.Data.Point(e.getCenter()):{properties:{radius:e.getRadius()},geometry:new google.maps.Data.Point(e.getCenter())}}},transformToMVCArray:function(e){let t=new google.maps.MVCArray;function o(s,n){s.length==2&&!Array.isArray(s[0])&&!Array.isArray(s[1])&&n.push(new google.maps.LatLng(s[1],s[0]));for(let i=0;i<s.length;i++)Array.isArray(s[i])&&o(s[i],n?s[i].length==2&&!Array.isArray(s[i][0])&&!Array.isArray(s[i][1])?n:n.getAt(n.push(new google.maps.MVCArray)-1):t.getAt(t.push(new google.maps.MVCArray)-1))}function a(s){return s instanceof google.maps.MVCArray}return o(e),t},loadFeaturesCollection:function(e){if(Array.isArray(e.features)&&e.features.length>0){let t=new google.maps.LatLngBounds;for(let o=0;o<e.features.length;o++){let a=this.instanceOverlay(e.features[o]);a.feature=this.instanceFeature(a),this.addOverlayEvents(a),a.feature.getGeometry().forEachLatLng(function(s){t.extend(s)}),a.setMap(this.map),this.overlays.push(a)}this.map.fitBounds(t)}},addOverlayEvents:function(e){switch(e.type){case google.maps.drawing.OverlayType.POLYLINE:google.maps.event.addListener(e.getPath(),"set_at",()=>{e.drag||(e.feature.setGeometry(this.calculateGeometry(e,!0)),this.drawingModified())}),google.maps.event.addListener(e.getPath(),"insert_at",()=>{e.feature.setGeometry(this.calculateGeometry(e,!0)),this.drawingModified()}),google.maps.event.addListener(e.getPath(),"remove_at",()=>{e.feature.setGeometry(this.calculateGeometry(e,!0)),this.drawingModified()});break;case google.maps.drawing.OverlayType.POLYGON:let t=e.getPaths();for(let o=0;o<t.getLength();o++)for(let a=0;a<t.getAt(o).getLength();a++)google.maps.event.addListener(t.getAt(o),"set_at",()=>{e.drag||(e.feature.setGeometry(this.calculateGeometry(e,!0)),this.drawingModified())}),google.maps.event.addListener(t.getAt(o),"insert_at",()=>{e.feature.setGeometry(this.calculateGeometry(e,!0)),this.drawingModified()}),google.maps.event.addListener(t.getAt(o),"remove_at",()=>{e.feature.setGeometry(this.calculateGeometry(e,!0)),this.drawingModified()});break;case google.maps.drawing.OverlayType.RECTANGLE:google.maps.event.addListener(e,"bounds_changed",()=>{e.drag||(e.feature.setGeometry(this.calculateGeometry(e,!0)),this.drawingModified())});break;case google.maps.drawing.OverlayType.CIRCLE:google.maps.event.addListener(e,"radius_changed",()=>{e.feature.setProperty("radius",this.calculateGeometry(e).properties.radius),this.drawingModified()});break}if(e.type!==google.maps.drawing.OverlayType.MARKER){let t=this;google.maps.event.addListener(e,"click",function(o){t.setSelection(this)})}google.maps.event.addListener(e,"dragstart",()=>{e.drag=!0}),google.maps.event.addListener(e,"mouseup",()=>{e.drag&&(e.drag=!1,e.feature.setGeometry(this.calculateGeometry(e,!0)),this.drawingModified())})},drawingModified:function(){m&&this.dataLayer.toGeoJson(e=>{r(m,JSON.stringify(e))})},guid:function(){function e(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},setSelection:function(e){this.clearSelection(),this.selectedShape=e,this.overlays.forEach(function(t){e&&t.id==e.id?(t.getEditable()?e.setOptions({strokeColor:"#00ff00",strokeOpacity:"0.5"}):e.setOptions({strokeColor:"#ff0000",strokeOpacity:"0.8"}),t.setEditable(!t.getEditable())):t.setEditable(!1)})},clearSelection:function(){this.selectedShape=null,this.overlays.forEach(function(e){e.setEditable(!1),e.setOptions({strokeColor:"#00ff00",strokeOpacity:"0.5"})})},geoJsonContains:function(e){if(p&&y){let t=[],o=new google.maps.Data;this.geoJsonDataLayer.forEach(s=>{if(s.getGeometry().getType()==="Polygon"){var n=new google.maps.Polygon({path:s.getGeometry().getAt(0).getArray()});google.maps.geometry.poly.containsLocation(e,n)&&(d?t.push(s.getProperty(d)):o.add(s))}s.getGeometry().getType()==="MultiPolygon"&&s.getGeometry().getArray().forEach(function(W,X){let z=W.getAt(0).getArray(),q=new google.maps.Polygon({paths:z});google.maps.geometry.poly.containsLocation(e,q)&&(d?t.push(s.getProperty(d)):o.add(s))})});let a;d?(a=JSON.stringify(t),r(y,a)):o.toGeoJson(s=>{a=JSON.stringify(s),r(y,a)})}}}}export{H as default};
