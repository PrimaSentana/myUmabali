var{getOwnPropertyNames:yt,getOwnPropertySymbols:wt}=Object,{hasOwnProperty:Et}=Object.prototype;function U(r,t){return function(e,n,i){return r(e,n,i)&&t(e,n,i)}}function R(r){return function(s,e,n){if(!s||!e||typeof s!="object"||typeof e!="object")return r(s,e,n);let{cache:i}=n,a=i.get(s),c=i.get(e);if(a&&c)return a===e&&c===s;i.set(s,e),i.set(e,s);let o=r(s,e,n);return i.delete(s),i.delete(e),o}}function Mt(r){return r?.[Symbol.toStringTag]}function nt(r){return yt(r).concat(wt(r))}var kt=Object.hasOwn||((r,t)=>Et.call(r,t));function C(r,t){return r===t||!r&&!t&&r!==r&&t!==t}var At="__v",xt="__o",vt="_owner",{getOwnPropertyDescriptor:it,keys:ot}=Object;function _t(r,t){return r.byteLength===t.byteLength&&D(new Uint8Array(r),new Uint8Array(t))}function Pt(r,t,s){let e=r.length;if(t.length!==e)return!1;for(;e-- >0;)if(!s.equals(r[e],t[e],e,e,r,t,s))return!1;return!0}function Ct(r,t){return r.byteLength===t.byteLength&&D(new Uint8Array(r.buffer,r.byteOffset,r.byteLength),new Uint8Array(t.buffer,t.byteOffset,t.byteLength))}function Lt(r,t){return C(r.getTime(),t.getTime())}function Tt(r,t){return r.name===t.name&&r.message===t.message&&r.cause===t.cause&&r.stack===t.stack}function Ot(r,t){return r===t}function at(r,t,s){let e=r.size;if(e!==t.size)return!1;if(!e)return!0;let n=new Array(e),i=r.entries(),a,c,o=0;for(;(a=i.next())&&!a.done;){let l=t.entries(),u=!1,h=0;for(;(c=l.next())&&!c.done;){if(n[h]){h++;continue}let d=a.value,m=c.value;if(s.equals(d[0],m[0],o,h,r,t,s)&&s.equals(d[1],m[1],d[0],m[0],r,t,s)){u=n[h]=!0;break}h++}if(!u)return!1;o++}return!0}var bt=C;function It(r,t,s){let e=ot(r),n=e.length;if(ot(t).length!==n)return!1;for(;n-- >0;)if(!lt(r,t,s,e[n]))return!1;return!0}function b(r,t,s){let e=nt(r),n=e.length;if(nt(t).length!==n)return!1;let i,a,c;for(;n-- >0;)if(i=e[n],!lt(r,t,s,i)||(a=it(r,i),c=it(t,i),(a||c)&&(!a||!c||a.configurable!==c.configurable||a.enumerable!==c.enumerable||a.writable!==c.writable)))return!1;return!0}function St(r,t){return C(r.valueOf(),t.valueOf())}function jt(r,t){return r.source===t.source&&r.flags===t.flags}function ct(r,t,s){let e=r.size;if(e!==t.size)return!1;if(!e)return!0;let n=new Array(e),i=r.values(),a,c;for(;(a=i.next())&&!a.done;){let o=t.values(),l=!1,u=0;for(;(c=o.next())&&!c.done;){if(!n[u]&&s.equals(a.value,c.value,a.value,c.value,r,t,s)){l=n[u]=!0;break}u++}if(!l)return!1}return!0}function D(r,t){let s=r.byteLength;if(t.byteLength!==s||r.byteOffset!==t.byteOffset)return!1;for(;s-- >0;)if(r[s]!==t[s])return!1;return!0}function qt(r,t){return r.hostname===t.hostname&&r.pathname===t.pathname&&r.protocol===t.protocol&&r.port===t.port&&r.hash===t.hash&&r.username===t.username&&r.password===t.password}function lt(r,t,s,e){return(e===vt||e===xt||e===At)&&(r.$$typeof||t.$$typeof)?!0:kt(t,e)&&s.equals(r[e],t[e],e,e,r,t,s)}var Bt="[object ArrayBuffer]",Rt="[object Arguments]",Dt="[object Boolean]",Zt="[object DataView]",Ft="[object Date]",Nt="[object Error]",Ut="[object Map]",Gt="[object Number]",zt="[object Object]",$t="[object RegExp]",Wt="[object Set]",Vt="[object String]",Kt={"[object Int8Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Int16Array]":!0,"[object Uint16Array]":!0,"[object Int32Array]":!0,"[object Uint32Array]":!0,"[object Float16Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0,"[object BigInt64Array]":!0,"[object BigUint64Array]":!0},Ht="[object URL]",Jt=Object.prototype.toString;function Yt({areArrayBuffersEqual:r,areArraysEqual:t,areDataViewsEqual:s,areDatesEqual:e,areErrorsEqual:n,areFunctionsEqual:i,areMapsEqual:a,areNumbersEqual:c,areObjectsEqual:o,arePrimitiveWrappersEqual:l,areRegExpsEqual:u,areSetsEqual:h,areTypedArraysEqual:d,areUrlsEqual:m,unknownTagComparators:y}){return function(f,p,g){if(f===p)return!0;if(f==null||p==null)return!1;let k=typeof f;if(k!==typeof p)return!1;if(k!=="object")return k==="number"?c(f,p,g):k==="function"?i(f,p,g):!1;let x=f.constructor;if(x!==p.constructor)return!1;if(x===Object)return o(f,p,g);if(Array.isArray(f))return t(f,p,g);if(x===Date)return e(f,p,g);if(x===RegExp)return u(f,p,g);if(x===Map)return a(f,p,g);if(x===Set)return h(f,p,g);let E=Jt.call(f);if(E===Ft)return e(f,p,g);if(E===$t)return u(f,p,g);if(E===Ut)return a(f,p,g);if(E===Wt)return h(f,p,g);if(E===zt)return typeof f.then!="function"&&typeof p.then!="function"&&o(f,p,g);if(E===Ht)return m(f,p,g);if(E===Nt)return n(f,p,g);if(E===Rt)return o(f,p,g);if(Kt[E])return d(f,p,g);if(E===Bt)return r(f,p,g);if(E===Zt)return s(f,p,g);if(E===Dt||E===Gt||E===Vt)return l(f,p,g);if(y){let O=y[E];if(!O){let A=Mt(f);A&&(O=y[A])}if(O)return O(f,p,g)}return!1}}function Qt({circular:r,createCustomConfig:t,strict:s}){let e={areArrayBuffersEqual:_t,areArraysEqual:s?b:Pt,areDataViewsEqual:Ct,areDatesEqual:Lt,areErrorsEqual:Tt,areFunctionsEqual:Ot,areMapsEqual:s?U(at,b):at,areNumbersEqual:bt,areObjectsEqual:s?b:It,arePrimitiveWrappersEqual:St,areRegExpsEqual:jt,areSetsEqual:s?U(ct,b):ct,areTypedArraysEqual:s?U(D,b):D,areUrlsEqual:qt,unknownTagComparators:void 0};if(t&&(e=Object.assign({},e,t(e))),r){let n=R(e.areArraysEqual),i=R(e.areMapsEqual),a=R(e.areObjectsEqual),c=R(e.areSetsEqual);e=Object.assign({},e,{areArraysEqual:n,areMapsEqual:i,areObjectsEqual:a,areSetsEqual:c})}return e}function Xt(r){return function(t,s,e,n,i,a,c){return r(t,s,c)}}function te({circular:r,comparator:t,createState:s,equals:e,strict:n}){if(s)return function(c,o){let{cache:l=r?new WeakMap:void 0,meta:u}=s();return t(c,o,{cache:l,equals:e,meta:u,strict:n})};if(r)return function(c,o){return t(c,o,{cache:new WeakMap,equals:e,meta:void 0,strict:n})};let i={cache:void 0,equals:e,meta:void 0,strict:n};return function(c,o){return t(c,o,i)}}var G=v(),le=v({strict:!0}),ue=v({circular:!0}),he=v({circular:!0,strict:!0}),fe=v({createInternalComparator:()=>C}),de=v({strict:!0,createInternalComparator:()=>C}),pe=v({circular:!0,createInternalComparator:()=>C}),me=v({circular:!0,createInternalComparator:()=>C,strict:!0});function v(r={}){let{circular:t=!1,createInternalComparator:s,createState:e,strict:n=!1}=r,i=Qt(r),a=Yt(i),c=s?s(a):Xt(a);return te({circular:t,comparator:a,createState:e,equals:c,strict:n})}var ut=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],z=1,I=8,j=class r{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[s,e]=new Uint8Array(t,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");let n=e>>4;if(n!==z)throw new Error(`Got v${n} data when expected v${z}.`);let i=ut[e&15];if(!i)throw new Error("Unrecognized array type.");let[a]=new Uint16Array(t,2,1),[c]=new Uint32Array(t,4,1);return new r(c,a,i,t)}constructor(t,s=64,e=Float64Array,n){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=e,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;let i=ut.indexOf(this.ArrayType),a=t*2*this.ArrayType.BYTES_PER_ELEMENT,c=t*this.IndexArrayType.BYTES_PER_ELEMENT,o=(8-c%8)%8;if(i<0)throw new Error(`Unexpected typed array class: ${e}.`);n&&n instanceof ArrayBuffer?(this.data=n,this.ids=new this.IndexArrayType(this.data,I,t),this.coords=new this.ArrayType(this.data,I+c+o,t*2),this._pos=t*2,this._finished=!0):(this.data=new ArrayBuffer(I+a+c+o),this.ids=new this.IndexArrayType(this.data,I,t),this.coords=new this.ArrayType(this.data,I+c+o,t*2),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,(z<<4)+i]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=t)}add(t,s){let e=this._pos>>1;return this.ids[e]=e,this.coords[this._pos++]=t,this.coords[this._pos++]=s,e}finish(){let t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return W(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,s,e,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:i,coords:a,nodeSize:c}=this,o=[0,i.length-1,0],l=[];for(;o.length;){let u=o.pop()||0,h=o.pop()||0,d=o.pop()||0;if(h-d<=c){for(let f=d;f<=h;f++){let p=a[2*f],g=a[2*f+1];p>=t&&p<=e&&g>=s&&g<=n&&l.push(i[f])}continue}let m=d+h>>1,y=a[2*m],w=a[2*m+1];y>=t&&y<=e&&w>=s&&w<=n&&l.push(i[m]),(u===0?t<=y:s<=w)&&(o.push(d),o.push(m-1),o.push(1-u)),(u===0?e>=y:n>=w)&&(o.push(m+1),o.push(h),o.push(1-u))}return l}within(t,s,e){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:n,coords:i,nodeSize:a}=this,c=[0,n.length-1,0],o=[],l=e*e;for(;c.length;){let u=c.pop()||0,h=c.pop()||0,d=c.pop()||0;if(h-d<=a){for(let f=d;f<=h;f++)ht(i[2*f],i[2*f+1],t,s)<=l&&o.push(n[f]);continue}let m=d+h>>1,y=i[2*m],w=i[2*m+1];ht(y,w,t,s)<=l&&o.push(n[m]),(u===0?t-e<=y:s-e<=w)&&(c.push(d),c.push(m-1),c.push(1-u)),(u===0?t+e>=y:s+e>=w)&&(c.push(m+1),c.push(h),c.push(1-u))}return o}};function W(r,t,s,e,n,i){if(n-e<=s)return;let a=e+n>>1;ft(r,t,a,e,n,i),W(r,t,s,e,a-1,1-i),W(r,t,s,a+1,n,1-i)}function ft(r,t,s,e,n,i){for(;n>e;){if(n-e>600){let l=n-e+1,u=s-e+1,h=Math.log(l),d=.5*Math.exp(2*h/3),m=.5*Math.sqrt(h*d*(l-d)/l)*(u-l/2<0?-1:1),y=Math.max(e,Math.floor(s-u*d/l+m)),w=Math.min(n,Math.floor(s+(l-u)*d/l+m));ft(r,t,s,y,w,i)}let a=t[2*s+i],c=e,o=n;for(S(r,t,e,s),t[2*n+i]>a&&S(r,t,e,n);c<o;){for(S(r,t,c,o),c++,o--;t[2*c+i]<a;)c++;for(;t[2*o+i]>a;)o--}t[2*e+i]===a?S(r,t,e,o):(o++,S(r,t,o,n)),o<=s&&(e=o+1),s<=o&&(n=o-1)}}function S(r,t,s,e){$(r,s,e),$(t,2*s,2*e),$(t,2*s+1,2*e+1)}function $(r,t,s){let e=r[t];r[t]=r[s],r[s]=e}function ht(r,t,s,e){let n=r-s,i=t-e;return n*n+i*i}var ee={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:r=>r},dt=Math.fround||(r=>(t=>(r[0]=+t,r[0])))(new Float32Array(1)),L=2,P=3,V=4,_=5,mt=6,q=class{constructor(t){this.options=Object.assign(Object.create(ee),t),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(t){let{log:s,minZoom:e,maxZoom:n}=this.options;s&&console.time("total time");let i=`prepare ${t.length} points`;s&&console.time(i),this.points=t;let a=[];for(let o=0;o<t.length;o++){let l=t[o];if(!l.geometry)continue;let[u,h]=l.geometry.coordinates,d=dt(Z(u)),m=dt(F(h));a.push(d,m,1/0,o,-1,1),this.options.reduce&&a.push(0)}let c=this.trees[n+1]=this._createTree(a);s&&console.timeEnd(i);for(let o=n;o>=e;o--){let l=+Date.now();c=this.trees[o]=this._createTree(this._cluster(c,o)),s&&console.log("z%d: %d clusters in %dms",o,c.numItems,+Date.now()-l)}return s&&console.timeEnd("total time"),this}getClusters(t,s){let e=((t[0]+180)%360+360)%360-180,n=Math.max(-90,Math.min(90,t[1])),i=t[2]===180?180:((t[2]+180)%360+360)%360-180,a=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)e=-180,i=180;else if(e>i){let h=this.getClusters([e,n,180,a],s),d=this.getClusters([-180,n,i,a],s);return h.concat(d)}let c=this.trees[this._limitZoom(s)],o=c.range(Z(e),F(a),Z(i),F(n)),l=c.data,u=[];for(let h of o){let d=this.stride*h;u.push(l[d+_]>1?pt(l,d,this.clusterProps):this.points[l[d+P]])}return u}getChildren(t){let s=this._getOriginId(t),e=this._getOriginZoom(t),n="No cluster with the specified id.",i=this.trees[e];if(!i)throw new Error(n);let a=i.data;if(s*this.stride>=a.length)throw new Error(n);let c=this.options.radius/(this.options.extent*Math.pow(2,e-1)),o=a[s*this.stride],l=a[s*this.stride+1],u=i.within(o,l,c),h=[];for(let d of u){let m=d*this.stride;a[m+V]===t&&h.push(a[m+_]>1?pt(a,m,this.clusterProps):this.points[a[m+P]])}if(h.length===0)throw new Error(n);return h}getLeaves(t,s,e){s=s||10,e=e||0;let n=[];return this._appendLeaves(n,t,s,e,0),n}getTile(t,s,e){let n=this.trees[this._limitZoom(t)],i=Math.pow(2,t),{extent:a,radius:c}=this.options,o=c/a,l=(e-o)/i,u=(e+1+o)/i,h={features:[]};return this._addTileFeatures(n.range((s-o)/i,l,(s+1+o)/i,u),n.data,s,e,i,h),s===0&&this._addTileFeatures(n.range(1-o/i,l,1,u),n.data,i,e,i,h),s===i-1&&this._addTileFeatures(n.range(0,l,o/i,u),n.data,-1,e,i,h),h.features.length?h:null}getClusterExpansionZoom(t){let s=this._getOriginZoom(t)-1;for(;s<=this.options.maxZoom;){let e=this.getChildren(t);if(s++,e.length!==1)break;t=e[0].properties.cluster_id}return s}_appendLeaves(t,s,e,n,i){let a=this.getChildren(s);for(let c of a){let o=c.properties;if(o&&o.cluster?i+o.point_count<=n?i+=o.point_count:i=this._appendLeaves(t,o.cluster_id,e,n,i):i<n?i++:t.push(c),t.length===e)break}return i}_createTree(t){let s=new j(t.length/this.stride|0,this.options.nodeSize,Float32Array);for(let e=0;e<t.length;e+=this.stride)s.add(t[e],t[e+1]);return s.finish(),s.data=t,s}_addTileFeatures(t,s,e,n,i,a){for(let c of t){let o=c*this.stride,l=s[o+_]>1,u,h,d;if(l)u=gt(s,o,this.clusterProps),h=s[o],d=s[o+1];else{let w=this.points[s[o+P]];u=w.properties;let[f,p]=w.geometry.coordinates;h=Z(f),d=F(p)}let m={type:1,geometry:[[Math.round(this.options.extent*(h*i-e)),Math.round(this.options.extent*(d*i-n))]],tags:u},y;l||this.options.generateId?y=s[o+P]:y=this.points[s[o+P]].id,y!==void 0&&(m.id=y),a.features.push(m)}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(Math.floor(+t),this.options.maxZoom+1))}_cluster(t,s){let{radius:e,extent:n,reduce:i,minPoints:a}=this.options,c=e/(n*Math.pow(2,s)),o=t.data,l=[],u=this.stride;for(let h=0;h<o.length;h+=u){if(o[h+L]<=s)continue;o[h+L]=s;let d=o[h],m=o[h+1],y=t.within(o[h],o[h+1],c),w=o[h+_],f=w;for(let p of y){let g=p*u;o[g+L]>s&&(f+=o[g+_])}if(f>w&&f>=a){let p=d*w,g=m*w,k,x=-1,E=((h/u|0)<<5)+(s+1)+this.points.length;for(let O of y){let A=O*u;if(o[A+L]<=s)continue;o[A+L]=s;let rt=o[A+_];p+=o[A]*rt,g+=o[A+1]*rt,o[A+V]=E,i&&(k||(k=this._map(o,h,!0),x=this.clusterProps.length,this.clusterProps.push(k)),i(k,this._map(o,A)))}o[h+V]=E,l.push(p/f,g/f,1/0,E,-1,f),i&&l.push(x)}else{for(let p=0;p<u;p++)l.push(o[h+p]);if(f>1)for(let p of y){let g=p*u;if(!(o[g+L]<=s)){o[g+L]=s;for(let k=0;k<u;k++)l.push(o[g+k])}}}}return l}_getOriginId(t){return t-this.points.length>>5}_getOriginZoom(t){return(t-this.points.length)%32}_map(t,s,e){if(t[s+_]>1){let a=this.clusterProps[t[s+mt]];return e?Object.assign({},a):a}let n=this.points[t[s+P]].properties,i=this.options.map(n);return e&&i===n?Object.assign({},i):i}};function pt(r,t,s){return{type:"Feature",id:r[t+P],properties:gt(r,t,s),geometry:{type:"Point",coordinates:[se(r[t]),re(r[t+1])]}}}function gt(r,t,s){let e=r[t+_],n=e>=1e4?`${Math.round(e/1e3)}k`:e>=1e3?`${Math.round(e/100)/10}k`:e,i=r[t+mt],a=i===-1?{}:Object.assign({},s[i]);return Object.assign(a,{cluster:!0,cluster_id:r[t+P],point_count:e,point_count_abbreviated:n})}function Z(r){return r/360+.5}function F(r){let t=Math.sin(r*Math.PI/180),s=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return s<0?0:s>1?1:s}function se(r){return(r-.5)*360}function re(r){let t=(180-r*360)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function ne(r,t){var s={};for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&t.indexOf(e)<0&&(s[e]=r[e]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,e=Object.getOwnPropertySymbols(r);n<e.length;n++)t.indexOf(e[n])<0&&Object.prototype.propertyIsEnumerable.call(r,e[n])&&(s[e[n]]=r[e[n]]);return s}var M=class{static isAdvancedMarkerAvailable(t){return google.maps.marker&&t.getMapCapabilities().isAdvancedMarkersAvailable===!0}static isAdvancedMarker(t){return google.maps.marker&&t instanceof google.maps.marker.AdvancedMarkerElement}static setMap(t,s){this.isAdvancedMarker(t)?t.map=s:t.setMap(s)}static getPosition(t){if(this.isAdvancedMarker(t)){if(t.position){if(t.position instanceof google.maps.LatLng)return t.position;if(Number.isFinite(t.position.lat)&&Number.isFinite(t.position.lng))return new google.maps.LatLng(t.position.lat,t.position.lng)}return new google.maps.LatLng(null)}return t.getPosition()}static getVisible(t){return this.isAdvancedMarker(t)?!0:t.getVisible()}},B=class{constructor({markers:t,position:s}){this.markers=[],t&&(this.markers=t),s&&(s instanceof google.maps.LatLng?this._position=s:this._position=new google.maps.LatLng(s))}get bounds(){if(this.markers.length===0&&!this._position)return;let t=new google.maps.LatLngBounds(this._position,this._position);for(let s of this.markers)t.extend(M.getPosition(s));return t}get position(){return this._position||this.bounds.getCenter()}get count(){return this.markers.filter(t=>M.getVisible(t)).length}push(t){this.markers.push(t)}delete(){this.marker&&(M.setMap(this.marker,null),this.marker=void 0),this.markers.length=0}};function K(r,t="assertion failed"){if(r==null)throw Error(t)}var H=class{constructor({maxZoom:t=16}){this.maxZoom=t}noop({markers:t}){return ie(t)}};var ie=r=>r.map(s=>new B({position:M.getPosition(s),markers:[s]}));var J=class extends H{constructor(t){var{maxZoom:s,radius:e=60}=t,n=ne(t,["maxZoom","radius"]);super({maxZoom:s}),this.markers=[],this.clusters=[],this.state={zoom:-1},this.superCluster=new q(Object.assign({maxZoom:this.maxZoom,radius:e},n))}calculate(t){let s=!1,e=t.map.getZoom();K(e),e=Math.round(e);let n={zoom:e};if(!G(t.markers,this.markers)){s=!0,this.markers=[...t.markers];let i=this.markers.map(a=>{let c=M.getPosition(a);return{type:"Feature",geometry:{type:"Point",coordinates:[c.lng(),c.lat()]},properties:{marker:a}}});this.superCluster.load(i)}return s||(this.state.zoom<=this.maxZoom||n.zoom<=this.maxZoom)&&(s=!G(this.state,n)),this.state=n,t.markers.length===0?(this.clusters=[],{clusters:this.clusters,changed:s}):(s&&(this.clusters=this.cluster(t)),{clusters:this.clusters,changed:s})}cluster({map:t}){let s=t.getZoom();return K(s),this.superCluster.getClusters([-180,-90,180,90],Math.round(s)).map(e=>this.transformCluster(e))}transformCluster({geometry:{coordinates:[t,s]},properties:e}){if(e.cluster)return new B({markers:this.superCluster.getLeaves(e.cluster_id,1/0).map(i=>i.properties.marker),position:{lat:s,lng:t}});let n=e.marker;return new B({markers:[n],position:M.getPosition(n)})}};var Y=class{constructor(t,s){this.markers={sum:t.length};let e=s.map(i=>i.count),n=e.reduce((i,a)=>i+a,0);this.clusters={count:s.length,markers:{mean:n/s.length,sum:n,min:Math.min(...e),max:Math.max(...e)}}}},Q=class{render({count:t,position:s},e,n){let a=`<svg fill="${t>Math.max(10,e.clusters.markers.mean)?"#ff0000":"#0000ff"}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 240 240" width="50" height="50">
<circle cx="120" cy="120" opacity=".6" r="70" />
<circle cx="120" cy="120" opacity=".3" r="90" />
<circle cx="120" cy="120" opacity=".2" r="110" />
<text x="50%" y="50%" style="fill:#fff" text-anchor="middle" font-size="50" dominant-baseline="middle" font-family="roboto,arial,sans-serif">${t}</text>
</svg>`,c=`Cluster of ${t} markers`,o=Number(google.maps.Marker.MAX_ZINDEX)+t;if(M.isAdvancedMarkerAvailable(n)){let h=new DOMParser().parseFromString(a,"image/svg+xml").documentElement;h.setAttribute("transform","translate(0 25)");let d={map:n,position:s,zIndex:o,title:c,content:h};return new google.maps.marker.AdvancedMarkerElement(d)}let l={position:s,zIndex:o,title:c,icon:{url:`data:image/svg+xml;base64,${btoa(a)}`,anchor:new google.maps.Point(25,25)}};return new google.maps.Marker(l)}};function oe(r,t){for(let s in t.prototype)r.prototype[s]=t.prototype[s]}var X=class r{constructor(){oe(r,google.maps.OverlayView)}},T;(function(r){r.CLUSTERING_BEGIN="clusteringbegin",r.CLUSTERING_END="clusteringend",r.CLUSTER_CLICK="click",r.GMP_CLICK="gmp-click"})(T||(T={}));var ae=(r,t,s)=>{t.bounds&&s.fitBounds(t.bounds)},N=class extends X{constructor({map:t,markers:s=[],algorithmOptions:e={},algorithm:n=new J(e),renderer:i=new Q,onClusterClick:a=ae}){super(),this.map=null,this.idleListener=null,this.markers=[...s],this.clusters=[],this.algorithm=n,this.renderer=i,this.onClusterClick=a,t&&this.setMap(t)}addMarker(t,s){this.markers.includes(t)||(this.markers.push(t),s||this.render())}addMarkers(t,s){t.forEach(e=>{this.addMarker(e,!0)}),s||this.render()}removeMarker(t,s){let e=this.markers.indexOf(t);return e===-1?!1:(M.setMap(t,null),this.markers.splice(e,1),s||this.render(),!0)}removeMarkers(t,s){let e=!1;return t.forEach(n=>{e=this.removeMarker(n,!0)||e}),e&&!s&&this.render(),e}clearMarkers(t){this.markers.length=0,t||this.render()}render(){let t=this.getMap();if(t instanceof google.maps.Map&&t.getProjection()){google.maps.event.trigger(this,T.CLUSTERING_BEGIN,this);let{clusters:s,changed:e}=this.algorithm.calculate({markers:this.markers,map:t,mapCanvasProjection:this.getProjection()});if(e||e==null){let n=new Set;for(let a of s)a.markers.length==1&&n.add(a.markers[0]);let i=[];for(let a of this.clusters)a.marker!=null&&(a.markers.length==1?n.has(a.marker)||M.setMap(a.marker,null):i.push(a.marker));this.clusters=s,this.renderClusters(),requestAnimationFrame(()=>i.forEach(a=>M.setMap(a,null)))}google.maps.event.trigger(this,T.CLUSTERING_END,this)}}onAdd(){let t=this.getMap();K(t),this.idleListener=t.addListener("idle",this.render.bind(this)),this.render()}onRemove(){this.idleListener&&google.maps.event.removeListener(this.idleListener),this.reset()}reset(){this.markers.forEach(t=>M.setMap(t,null)),this.clusters.forEach(t=>t.delete()),this.clusters=[]}renderClusters(){let t=new Y(this.markers,this.clusters),s=this.getMap();this.clusters.forEach(e=>{if(e.markers.length===1)e.marker=e.markers[0];else if(e.marker=this.renderer.render(e,t,s),e.markers.forEach(n=>M.setMap(n,null)),this.onClusterClick){let n=M.isAdvancedMarker(e.marker)?T.GMP_CLICK:T.CLUSTER_CLICK;e.marker.addListener(n,i=>{google.maps.event.trigger(this,T.CLUSTER_CLICK,e),this.onClusterClick(i,e,s)})}M.setMap(e.marker,s)})}};function tt(r,t){return t=t==null?r.length-1:+t,function(){for(var s=Math.max(arguments.length-t,0),e=Array(s),n=0;n<s;n++)e[n]=arguments[n+t];switch(t){case 0:return r.call(this,e);case 1:return r.call(this,arguments[0],e);case 2:return r.call(this,arguments[0],arguments[1],e)}var i=Array(t+1);for(n=0;n<t;n++)i[n]=arguments[n];return i[t]=e,r.apply(this,i)}}var et=Date.now||function(){return new Date().getTime()};function st(r,t,s){var e,n,i,a,c,o=function(){var u=et()-n;t>u?e=setTimeout(o,t-u):(e=null,s||(a=r.apply(c,i)),e||(i=c=null))},l=tt(function(u){return c=this,i=u,n=et(),e||(e=setTimeout(o,t),s&&(a=r.apply(c,i))),a});return l.cancel=function(){clearTimeout(e),e=i=c=null},l}function ce({cachedData:r,config:t,mapEl:s}){return{map:null,bounds:null,infoWindow:null,mapEl:null,data:null,markers:[],layers:[],modelIds:[],mapIsFilter:!1,clusterer:null,center:null,isMapDragging:!1,isIdleSkipped:!1,config:{center:{lat:0,lng:0},clustering:!1,controls:{mapTypeControl:!0,scaleControl:!0,streetViewControl:!0,rotateControl:!0,fullscreenControl:!0,searchBoxControl:!1,zoomControl:!1},fit:!0,mapIsFilter:!1,gmaps:"",layers:[],zoom:12,markerAction:null,mapConfig:[]},loadGMaps:function(){if(document.getElementById("filament-google-maps-google-maps-js")){let e=function(n,i){window[n]?i():setTimeout(function(){e(n,i)},100)};e("filamentGoogleMapsAPILoaded",function(){this.createMap()}.bind(this))}else{let e=document.createElement("script");e.id="filament-google-maps-google-maps-js",window.filamentGoogleMapsAsyncLoad=this.createMap.bind(this),e.src=this.config.gmaps+"&callback=filamentGoogleMapsAsyncLoad",document.head.appendChild(e)}},init:function(){this.mapEl=document.getElementById(s)||s,this.data=r,this.config={...this.config,...t},this.loadGMaps()},callWire:function(e){},createMap:function(){window.filamentGoogleMapsAPILoaded=!0,this.infoWindow=new google.maps.InfoWindow({content:"",disableAutoPan:!0}),this.map=new google.maps.Map(this.mapEl,{center:this.config.center,zoom:this.config.zoom,...this.config.controls,...this.config.mapConfig}),this.center=this.config.center,this.createMarkers(),this.createClustering(),this.createLayers(),this.idle(),window.addEventListener("filament-google-maps::widget/setMapCenter",e=>{this.recenter(e.detail)}),this.show(!0)},show:function(e=!1){this.markers.length>0&&this.config.fit?this.fitToBounds(e):this.markers.length>0?this.map.setCenter(this.markers[0].getPosition()):this.map.setCenter(this.config.center)},createLayers:function(){this.layers=this.config.layers.map(e=>new google.maps.KmlLayer({url:e,map:this.map}))},createMarker:function(e){let n;e.icon&&typeof e.icon=="object"&&e.icon.hasOwnProperty("url")&&(n={url:e.icon.url},e.icon.hasOwnProperty("type")&&e.icon.type==="svg"&&e.icon.hasOwnProperty("scale")&&(n.scaledSize=new google.maps.Size(e.icon.scale[0],e.icon.scale[1])));let i=e.location,a=e.label,c=new google.maps.Marker({position:i,title:a,model_id:e.id,...n&&{icon:n}});return this.modelIds.indexOf(e.id)===-1&&this.modelIds.push(e.id),c},createMarkers:function(){this.markers=this.data.map(e=>{let n=this.createMarker(e);return n.setMap(this.map),this.config.markerAction&&google.maps.event.addListener(n,"click",i=>{this.$wire.mountAction(this.config.markerAction,{model_id:n.model_id})}),n})},removeMarker:function(e){e.setMap(null)},removeMarkers:function(){for(let e=0;e<this.markers.length;e++)this.markers[e].setMap(null);this.markers=[]},mergeMarkers:function(){let e=(l,u,h=!1)=>l.filter(d=>h===u.some(m=>d.getPosition().lat()===m.getPosition().lat()&&d.getPosition().lng()===m.getPosition().lng())),n=(l,u)=>e(l,u,!0),i=e,a=(l,u)=>i(u,l),c=this.data.map(l=>{let u=this.createMarker(l);return u.addListener("click",()=>{this.infoWindow.setContent(l.label),this.infoWindow.open(this.map,u)}),u});if(!this.config.mapIsFilter){let l=a(c,this.markers);for(let u=l.length-1;u>=0;u--){l[u].setMap(null);let h=this.markers.findIndex(d=>d.getPosition().lat()===l[u].getPosition().lat()&&d.getPosition().lng()===l[u].getPosition().lng());this.markers.splice(h,1)}}let o=a(this.markers,c);for(let l=0;l<o.length;l++)o[l].setMap(this.map),this.markers.push(o[l]);this.fitToBounds()},fitToBounds:function(e=!1){if(this.markers.length>0&&this.config.fit&&(e||!this.config.mapIsFilter)){this.bounds=new google.maps.LatLngBounds;for(let n of this.markers)this.bounds.extend(n.getPosition());this.map.fitBounds(this.bounds)}},createClustering:function(){this.markers.length>0&&this.config.clustering&&(this.clusterer=new N({map:this.map,markers:this.markers}))},updateClustering:function(){this.config.clustering&&(this.clusterer.clearMarkers(),this.clusterer.addMarkers(this.markers))},moved:function(){function e(c,o){return c.length===o.length?c.every((l,u)=>l===o[u]):!1}console.log("moved");let n=this.map.getBounds(),a=this.markers.filter(c=>n.contains(c.getPosition())).map(c=>c.model_id);e(this.modelIds,a)||(this.modelIds=a,console.log(a),this.$wire.set("mapFilterIds",a))},idle:function(){if(this.config.mapIsFilter){let e=self,n=st(this.moved,1e3).bind(this);google.maps.event.addListener(this.map,"idle",i=>{if(self.isMapDragging){self.idleSkipped=!0;return}self.idleSkipped=!1,n()}),google.maps.event.addListener(this.map,"dragstart",i=>{self.isMapDragging=!0}),google.maps.event.addListener(this.map,"dragend",i=>{self.isMapDragging=!1,self.idleSkipped===!0&&(n(),self.idleSkipped=!1)}),google.maps.event.addListener(this.map,"bounds_changed",i=>{self.idleSkipped=!1})}},update:function(e){this.data=e,this.mergeMarkers(),this.updateClustering(),this.show()},recenter:function(e){this.map.panTo({lat:e.lat,lng:e.lng}),this.map.setZoom(e.zoom)}}}export{ce as default};
